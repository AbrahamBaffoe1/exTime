-- Create database (run this separately if needed)
-- CREATE DATABASE timeclock_db;

-- Connect to the database
\c timeclock_db;

-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Create users table
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(255) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    "firstName" VARCHAR(255),
    "lastName" VARCHAR(255),
    "lastLogin" TIMESTAMP,
    "createdAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- Create enum types
CREATE TYPE action_type AS ENUM ('IN', 'OUT', 'BREAK_START', 'BREAK_END');
CREATE TYPE category_type AS ENUM ('regular', 'overtime', 'remote', 'training');

-- Create time_entries table
CREATE TABLE time_entries (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    "userId" UUID NOT NULL REFERENCES users(id),
    action action_type NOT NULL,
    timestamp TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    category category_type DEFAULT 'regular',
    notes TEXT,
    duration INTEGER,
    metadata JSONB,
    "createdAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY ("userId") REFERENCES users(id)
);

-- Create indexes
CREATE INDEX idx_time_entries_user_id ON time_entries("userId");
CREATE INDEX idx_time_entries_timestamp ON time_entries(timestamp);
